<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸°í›„ ë³€í™” ë¶„ì„ (í­ì—¼ì¼ìˆ˜, ì§‘ì¤‘í˜¸ìš° í¬í•¨)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      max-width: 960px;
      margin: 40px auto;
      font-family: 'Noto Sans KR', sans-serif;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    #prediction {
      font-weight: bold;
      font-size: 1.1em;
      margin-top: 20px;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
    }
    input[type="number"] {
      width: 70px;
      padding: 4px;
    }
    button {
      margin-top: 10px;
      padding: 6px 12px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>ê¸°í›„ ë³€í™”ì™€ ì´ìƒ ê¸°í›„ ì˜ˆì¸¡ (ì¸í„°ë™í‹°ë¸Œ)</h1>
  <table id="dataTable">
    <thead>
      <tr>
        <th>ì—°ë„</th>
        <th>í‰ê· ê¸°ì˜¨ (â„ƒ)</th>
        <th>ê°•ìˆ˜ëŸ‰ (mm)</th>
        <th>í­ì—¼ì¼ìˆ˜</th>
        <th>ì§‘ì¤‘í˜¸ìš°ì¼ìˆ˜</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="updateBtn">ê·¸ë˜í”„ ì—…ë°ì´íŠ¸</button>
  <canvas id="climateChart" width="900" height="400"></canvas>
  <div id="prediction"></div>

  <script>
    const years = Array.from({length: 31}, (_, i) => 1990 + i);
    let tempData = [24.1, 24.3, 24.5, 24.2, 24.7, 24.9, 25.0, 25.2, 25.5, 25.7,
                    25.6, 25.9, 26.0, 26.3, 26.4, 26.6, 26.7, 27.0, 27.3, 27.5,
                    27.6, 27.8, 28.0, 28.2, 28.5, 28.7, 28.9, 29.1, 29.3, 29.5, 29.8];
    let precipData = [300, 280, 320, 290, 310, 305, 300, 315, 320, 330,
                      340, 335, 345, 360, 350, 355, 365, 370, 380, 390,
                      395, 400, 410, 420, 430, 440, 445, 450, 460, 470, 480];
    let heatDaysData = years.map(y => Math.max(0, Math.floor((y - 1990) * 0.5 + 5)));
    let stormDaysData = years.map(y => Math.max(0, Math.floor((precipData[y-1990] - 300)/30 + 2)));

    function fillTable() {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      for (let i = 0; i < years.length; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${years[i]}</td>
          <td><input type="number" step="0.1" value="${tempData[i]}"></td>
          <td><input type="number" value="${precipData[i]}"></td>
          <td><input type="number" value="${heatDaysData[i]}"></td>
          <td><input type="number" value="${stormDaysData[i]}"></td>
        `;
        tbody.appendChild(row);
      }
    }

    function linearRegression(x, y) {
      const n = x.length;
      const meanX = x.reduce((a, b) => a + b) / n;
      const meanY = y.reduce((a, b) => a + b) / n;
      let num = 0, den = 0;
      for (let i = 0; i < n; i++) {
        num += (x[i] - meanX) * (y[i] - meanY);
        den += (x[i] - meanX) ** 2;
      }
      const a = num / den;
      const b = meanY - a * meanX;
      return { a, b };
    }

    let chart = null;
    function updateChart() {
      const tbody = document.querySelector('#dataTable tbody');
      tempData = [], precipData = [], heatDaysData = [], stormDaysData = [];
      for (let row of tbody.rows) {
        tempData.push(parseFloat(row.cells[1].firstChild.value));
        precipData.push(parseFloat(row.cells[2].firstChild.value));
        heatDaysData.push(parseFloat(row.cells[3].firstChild.value));
        stormDaysData.push(parseFloat(row.cells[4].firstChild.value));
      }

      const { a: aHeat, b: bHeat } = linearRegression(years, heatDaysData);
      const { a: aStorm, b: bStorm } = linearRegression(years, stormDaysData);
      const predHeat = aHeat * 2050 + bHeat;
      const predStorm = aStorm * 2050 + bStorm;

      const ctx = document.getElementById('climateChart').getContext('2d');
      const data = {
        labels: years,
        datasets: [
          {
            label: 'ê¸°ì˜¨ (â„ƒ)',
            data: tempData,
            borderColor: 'blue',
            yAxisID: 'y1',
            fill: false,
            tension: 0.1
          },
          {
            label: 'ê°•ìˆ˜ëŸ‰ (mm)',
            data: precipData,
            borderColor: 'green',
            yAxisID: 'y2',
            fill: false,
            tension: 0.1
          },
          {
            label: 'í­ì—¼ì¼ìˆ˜',
            data: heatDaysData,
            type: 'bar',
            backgroundColor: 'red',
            yAxisID: 'y3'
          },
          {
            label: 'ì§‘ì¤‘í˜¸ìš°ì¼ìˆ˜',
            data: stormDaysData,
            type: 'bar',
            backgroundColor: 'orange',
            yAxisID: 'y3'
          }
        ]
      };

      const options = {
        responsive: true,
        scales: {
          y1: { type: 'linear', position: 'left', title: { display: true, text: 'ê¸°ì˜¨(â„ƒ)' } },
          y2: { type: 'linear', position: 'right', title: { display: true, text: 'ê°•ìˆ˜ëŸ‰(mm)' }, grid: { drawOnChartArea: false } },
          y3: { type: 'linear', position: 'right', title: { display: true, text: 'ì¼ìˆ˜(ì¼)' }, offset: true }
        }
      };

      if (chart) {
        chart.data = data;
        chart.options = options;
        chart.update();
      } else {
        chart = new Chart(ctx, { type: 'line', data, options });
      }

      document.getElementById('prediction').innerHTML = `
        ğŸš¨ 2050ë…„ í­ì—¼ì¼ìˆ˜ ì˜ˆì¸¡: <strong>${predHeat.toFixed(1)}ì¼</strong><br/>
        ğŸš¨ 2050ë…„ ì§‘ì¤‘í˜¸ìš°ì¼ìˆ˜ ì˜ˆì¸¡: <strong>${predStorm.toFixed(1)}ì¼</strong>
      `;
    }

    document.getElementById('updateBtn').addEventListener('click', updateChart);
    fillTable();
    updateChart();
  </script>

<hr>
<h2>ğŸŒ´ ì—´ëŒ€ê¸°í›„ ë„ë‹¬ ì‹œì  ì˜ˆì¸¡</h2>
<p>ìµœí•œì›” í‰ê· ê¸°ì˜¨ì´ 18ë„ ì´ìƒì´ê³ , ëª¨ë“  ë‹¬ ê°•ìˆ˜ëŸ‰ì´ 60mm ì´ìƒì´ë©´ ì—´ëŒ€ê¸°í›„ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.</p>
<div>
  <label>ì›”ë³„ í‰ê· ê¸°ì˜¨ (â„ƒ):</label><br>
  <input id="monthlyTemps" type="text" value="2,4,9,15,20,23,27,29,25,18,10,5" style="width:100%">
</div>
<div>
  <label>ì›”ë³„ í‰ê· ê°•ìˆ˜ëŸ‰ (mm):</label><br>
  <input id="monthlyRains" type="text" value="20,30,45,55,60,70,90,120,100,80,50,40" style="width:100%">
</div>
<br>
<button onclick="checkTropicalClimate()">ì—´ëŒ€ê¸°í›„ ë„ë‹¬ ì—¬ë¶€ í™•ì¸</button>
<p id="tropicalResult"></p>

<script>
function checkTropicalClimate() {
  const temps = document.getElementById('monthlyTemps').value.split(',').map(Number);
  const rains = document.getElementById('monthlyRains').value.split(',').map(Number);

  const minTemp = Math.min(...temps);
  const allRainAbove60 = rains.every(val => val >= 60);

  let resultText = '';
  if (minTemp >= 18 && allRainAbove60) {
    resultText = 'âœ”ï¸ í˜„ì¬ ì…ë ¥ëœ ì§€í‘œë¡œ ì—´ëŒ€ê¸°í›„ ì¡°ê±´ì„ ì´ë¯¸ ì¶©ì¡±í•˜ê³  ìˆìŠµë‹ˆë‹¤!';
  } else {
    let tempNeeded = 18 - minTemp;
    let rainNeeded = rains.map(r => (r < 60 ? 60 - r : 0)).reduce((a, b) => a + b, 0);
    resultText = `âŒ ì—´ëŒ€ê¸°í›„ ì¡°ê±´ì„ ì•„ì§ ì¶©ì¡±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>`;
    if (tempNeeded > 0) resultText += `- ìµœí•œì›” í‰ê· ê¸°ì˜¨ì„ ${tempNeeded.toFixed(1)}â„ƒ ë†’ì—¬ì•¼ í•©ë‹ˆë‹¤.<br>`;
    if (rainNeeded > 0) resultText += `- ë¶€ì¡±í•œ ê°•ìˆ˜ëŸ‰ ì´í•©: ${rainNeeded.toFixed(1)}mm`;
  }

  document.getElementById('tropicalResult').innerHTML = resultText;
}
</script>

</body>
</html>
