<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>기후 변화 분석 (폭염일수, 집중호우 포함)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      max-width: 960px;
      margin: 40px auto;
      font-family: 'Noto Sans KR', sans-serif;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    #prediction {
      font-weight: bold;
      font-size: 1.1em;
      margin-top: 20px;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 6px;
      text-align: center;
    }
    input[type="number"] {
      width: 70px;
      padding: 4px;
    }
    button {
      margin-top: 10px;
      padding: 6px 12px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>기후 변화와 이상 기후 예측 (인터랙티브)</h1>
  <table id="dataTable">
    <thead>
      <tr>
        <th>연도</th>
        <th>평균기온 (℃)</th>
        <th>강수량 (mm)</th>
        <th>폭염일수</th>
        <th>집중호우일수</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="updateBtn">그래프 업데이트</button>
  <canvas id="climateChart" width="900" height="400"></canvas>
  <div id="prediction"></div>

  <script>
    const years = Array.from({length: 31}, (_, i) => 1990 + i);
    let tempData = [24.1, 24.3, 24.5, 24.2, 24.7, 24.9, 25.0, 25.2, 25.5, 25.7,
                    25.6, 25.9, 26.0, 26.3, 26.4, 26.6, 26.7, 27.0, 27.3, 27.5,
                    27.6, 27.8, 28.0, 28.2, 28.5, 28.7, 28.9, 29.1, 29.3, 29.5, 29.8];
    let precipData = [300, 280, 320, 290, 310, 305, 300, 315, 320, 330,
                      340, 335, 345, 360, 350, 355, 365, 370, 380, 390,
                      395, 400, 410, 420, 430, 440, 445, 450, 460, 470, 480];
    let heatDaysData = years.map(y => Math.max(0, Math.floor((y - 1990) * 0.5 + 5)));
    let stormDaysData = years.map(y => Math.max(0, Math.floor((precipData[y-1990] - 300)/30 + 2)));

    function fillTable() {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      for (let i = 0; i < years.length; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${years[i]}</td>
          <td><input type="number" step="0.1" value="${tempData[i]}"></td>
          <td><input type="number" value="${precipData[i]}"></td>
          <td><input type="number" value="${heatDaysData[i]}"></td>
          <td><input type="number" value="${stormDaysData[i]}"></td>
        `;
        tbody.appendChild(row);
      }
    }

    function linearRegression(x, y) {
      const n = x.length;
      const meanX = x.reduce((a, b) => a + b) / n;
      const meanY = y.reduce((a, b) => a + b) / n;
      let num = 0, den = 0;
      for (let i = 0; i < n; i++) {
        num += (x[i] - meanX) * (y[i] - meanY);
        den += (x[i] - meanX) ** 2;
      }
      const a = num / den;
      const b = meanY - a * meanX;
      return { a, b };
    }

    let chart = null;
    function updateChart() {
      const tbody = document.querySelector('#dataTable tbody');
      tempData = [], precipData = [], heatDaysData = [], stormDaysData = [];
      for (let row of tbody.rows) {
        tempData.push(parseFloat(row.cells[1].firstChild.value));
        precipData.push(parseFloat(row.cells[2].firstChild.value));
        heatDaysData.push(parseFloat(row.cells[3].firstChild.value));
        stormDaysData.push(parseFloat(row.cells[4].firstChild.value));
      }

      const { a: aHeat, b: bHeat } = linearRegression(years, heatDaysData);
      const { a: aStorm, b: bStorm } = linearRegression(years, stormDaysData);
      const predHeat = aHeat * 2050 + bHeat;
      const predStorm = aStorm * 2050 + bStorm;

      const ctx = document.getElementById('climateChart').getContext('2d');
      const data = {
        labels: years,
        datasets: [
          {
            label: '기온 (℃)',
            data: tempData,
            borderColor: 'blue',
            yAxisID: 'y1',
            fill: false,
            tension: 0.1
          },
          {
            label: '강수량 (mm)',
            data: precipData,
            borderColor: 'green',
            yAxisID: 'y2',
            fill: false,
            tension: 0.1
          },
          {
            label: '폭염일수',
            data: heatDaysData,
            type: 'bar',
            backgroundColor: 'red',
            yAxisID: 'y3'
          },
          {
            label: '집중호우일수',
            data: stormDaysData,
            type: 'bar',
            backgroundColor: 'orange',
            yAxisID: 'y3'
          }
        ]
      };

      const options = {
        responsive: true,
        scales: {
          y1: { type: 'linear', position: 'left', title: { display: true, text: '기온(℃)' } },
          y2: { type: 'linear', position: 'right', title: { display: true, text: '강수량(mm)' }, grid: { drawOnChartArea: false } },
          y3: { type: 'linear', position: 'right', title: { display: true, text: '일수(일)' }, offset: true }
        }
      };

      if (chart) {
        chart.data = data;
        chart.options = options;
        chart.update();
      } else {
        chart = new Chart(ctx, { type: 'line', data, options });
      }

      document.getElementById('prediction').innerHTML = `
        🚨 2050년 폭염일수 예측: <strong>${predHeat.toFixed(1)}일</strong><br/>
        🚨 2050년 집중호우일수 예측: <strong>${predStorm.toFixed(1)}일</strong>
      `;
    }

    document.getElementById('updateBtn').addEventListener('click', updateChart);
    fillTable();
    updateChart();
  </script>

<hr>
<h2>🌴 열대기후 도달 시점 예측</h2>
<p>최한월 평균기온이 18도 이상이고, 모든 달 강수량이 60mm 이상이면 열대기후로 판단합니다.</p>
<div>
  <label>월별 평균기온 (℃):</label><br>
  <input id="monthlyTemps" type="text" value="2,4,9,15,20,23,27,29,25,18,10,5" style="width:100%">
</div>
<div>
  <label>월별 평균강수량 (mm):</label><br>
  <input id="monthlyRains" type="text" value="20,30,45,55,60,70,90,120,100,80,50,40" style="width:100%">
</div>
<br>
<button onclick="checkTropicalClimate()">열대기후 도달 여부 확인</button>
<p id="tropicalResult"></p>

<script>
function checkTropicalClimate() {
  const temps = document.getElementById('monthlyTemps').value.split(',').map(Number);
  const rains = document.getElementById('monthlyRains').value.split(',').map(Number);

  const minTemp = Math.min(...temps);
  const allRainAbove60 = rains.every(val => val >= 60);

  let resultText = '';
  if (minTemp >= 18 && allRainAbove60) {
    resultText = '✔️ 현재 입력된 지표로 열대기후 조건을 이미 충족하고 있습니다!';
  } else {
    let tempNeeded = 18 - minTemp;
    let rainNeeded = rains.map(r => (r < 60 ? 60 - r : 0)).reduce((a, b) => a + b, 0);
    resultText = `❌ 열대기후 조건을 아직 충족하지 않았습니다.<br>`;
    if (tempNeeded > 0) resultText += `- 최한월 평균기온을 ${tempNeeded.toFixed(1)}℃ 높여야 합니다.<br>`;
    if (rainNeeded > 0) resultText += `- 부족한 강수량 총합: ${rainNeeded.toFixed(1)}mm`;
  }

  document.getElementById('tropicalResult').innerHTML = resultText;
}
</script>

</body>
</html>
